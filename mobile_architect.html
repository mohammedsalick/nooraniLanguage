<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Noorani Responsive Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Essential for mobile drawing to prevent page "bounce" */
        html, body { 
            overflow: hidden; 
            height: 100%; 
            width: 100%; 
            position: fixed;
            background-color: #f1f5f9;
        }
        canvas { 
            background: #fff; 
            touch-action: none; 
            image-rendering: auto;
            display: block;
        }
        .cursor-pointer { cursor: pointer; }
        .letter-btn { min-width: 50px; height: 50px; flex-shrink: 0; }
        .active-l { background: #4f46e5 !important; color: white; border-color: #4f46e5; }
        
        /* Custom scrollbar for the letter strip */
        #letterStrip::-webkit-scrollbar { height: 4px; }
        #letterStrip::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col w-full h-full">

    <div class="bg-slate-900 p-4 text-white flex justify-between items-center w-full z-10 shadow-md">
        <div class="flex flex-col">
            <h1 class="font-bold text-lg leading-tight">Noorani Tool</h1>
            <div class="flex gap-2 text-[10px]">
                <span class="text-indigo-400 font-bold" id="curInfo">A (V1)</span>
                <span class="text-emerald-400 font-bold" id="savedCount">0/130</span>
            </div>
        </div>
        <div class="flex gap-2">
            <label class="bg-blue-600 px-3 py-2 rounded-lg text-[10px] font-bold cursor-pointer flex items-center">
                IMPORT
                <input type="file" id="importFile" accept=".json" class="hidden" onchange="importJSON(event)">
            </label>
            <button onclick="downloadJSON()" class="bg-emerald-600 px-3 py-2 rounded-lg text-[10px] font-bold cursor-pointer">EXPORT</button>
        </div>
    </div>

    <div id="letterStrip" class="flex gap-2 p-3 overflow-x-auto bg-white border-b w-full shadow-sm">
        </div>

    <div class="flex-grow flex flex-col items-center justify-center p-4 bg-slate-100 relative">
        <div class="w-full max-w-[400px] aspect-square relative bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-slate-200">
            <canvas id="paint" class="w-full h-full"></canvas>
            <div class="absolute bottom-2 right-3 pointer-events-none">
                <span id="saveStatus" class="text-[10px] font-bold text-red-500 uppercase tracking-widest">Not Saved</span>
            </div>
        </div>
        
        <div class="flex gap-3 mt-6 w-full max-w-[400px]">
            <button onclick="clearCanvas()" class="flex-1 py-4 bg-white border-2 border-slate-200 text-slate-600 rounded-2xl font-bold cursor-pointer active:bg-slate-50 transition-colors">CLEAR</button>
            <button onclick="saveSymbol()" class="flex-1 py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200 cursor-pointer active:scale-95 transition-all">SAVE DRAWING</button>
        </div>
    </div>

    <div class="bg-white border-t p-4 pb-8 w-full shadow-[0_-4px_10px_rgba(0,0,0,0.05)]">
        <p class="text-[10px] font-bold text-slate-400 uppercase mb-3 tracking-widest text-center">Language Version</p>
        <div class="flex justify-between gap-2 max-w-[400px] mx-auto">
            <button onclick="setV(1)" id="v1" class="v-btn flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold cursor-pointer relative">1<span id="v1-check" class="hidden absolute -top-1 -right-1 bg-emerald-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">✓</span></button>
            <button onclick="setV(2)" id="v2" class="v-btn flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold cursor-pointer relative">2<span id="v2-check" class="hidden absolute -top-1 -right-1 bg-emerald-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">✓</span></button>
            <button onclick="setV(3)" id="v3" class="v-btn flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold cursor-pointer relative">3<span id="v3-check" class="hidden absolute -top-1 -right-1 bg-emerald-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">✓</span></button>
            <button onclick="setV(4)" id="v4" class="v-btn flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold cursor-pointer relative">4<span id="v4-check" class="hidden absolute -top-1 -right-1 bg-emerald-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">✓</span></button>
            <button onclick="setV(5)" id="v5" class="v-btn flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold cursor-pointer relative">5<span id="v5-check" class="hidden absolute -top-1 -right-1 bg-emerald-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center">✓</span></button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('paint');
        const ctx = canvas.getContext('2d');
        let currentL = 'A';
        let currentV = 1;
        let isDrawing = false;
        let storage = {};

        // Important: Resize internal buffer to match CSS display size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            // Scale by device pixel ratio for sharpness
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            // Set styles again after resize
            ctx.lineWidth = 6;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#1e293b';
            
            // Redraw if content exists
            loadDrawing();
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function start(e) { 
            isDrawing = true; 
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stop() { isDrawing = false; }

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); start(e); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});
        canvas.addEventListener('touchend', stop);
        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', stop);
        window.addEventListener('resize', resizeCanvas);

        // Letter Generation
        const strip = document.getElementById('letterStrip');
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(char => {
            const b = document.createElement('button');
            b.innerText = char;
            b.id = "btn-" + char;
            b.className = "letter-btn bg-white border-2 border-slate-100 rounded-xl font-bold text-slate-400 cursor-pointer shadow-sm";
            b.onclick = () => selectL(char);
            strip.appendChild(b);
        });

        function selectL(char) {
            currentL = char;
            document.querySelectorAll('.letter-btn').forEach(btn => btn.classList.remove('active-l'));
            document.getElementById('btn-'+char).classList.add('active-l');
            updateUI();
        }

        function setV(v) {
            currentV = v;
            document.querySelectorAll('.v-btn').forEach((btn, i) => {
                const isActive = (i + 1 === v);
                btn.className = isActive ? 
                    "v-btn flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold cursor-pointer relative" : 
                    "v-btn flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold cursor-pointer relative";
            });
            updateUI();
        }

        function updateUI() {
            document.getElementById('curInfo').innerText = `${currentL} (V${currentV})`;
            for(let v = 1; v <= 5; v++) {
                const check = document.getElementById(`v${v}-check`);
                check.classList.toggle('hidden', !(storage[currentL] && storage[currentL][v]));
            }
            loadDrawing();
            updateSaveStatus();
            updateSavedCount();
        }

        function loadDrawing() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(storage[currentL] && storage[currentL][currentV]) {
                const img = new Image();
                img.onload = () => {
                    const rect = canvas.getBoundingClientRect();
                    ctx.drawImage(img, 0, 0, rect.width, rect.height);
                };
                img.src = storage[currentL][currentV];
            }
        }

        function updateSaveStatus() {
            const status = document.getElementById('saveStatus');
            const isSaved = (storage[currentL] && storage[currentL][currentV]);
            status.innerText = isSaved ? "✓ Saved" : "Not Saved";
            status.className = isSaved ? "text-[10px] font-bold text-emerald-500 uppercase tracking-widest" : "text-[10px] font-bold text-red-500 uppercase tracking-widest";
        }

        function updateSavedCount() {
            let total = 0;
            Object.values(storage).forEach(vObj => total += Object.keys(vObj).length);
            document.getElementById('savedCount').innerText = `${total}/130`;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Optionally remove from storage if you want 'clear' to mean 'delete'
            // if(storage[currentL]) delete storage[currentL][currentV];
            updateSaveStatus();
        }

        function saveSymbol() {
            if(!storage[currentL]) storage[currentL] = {};
            storage[currentL][currentV] = canvas.toDataURL();
            updateUI();
            // Minor vibration for feedback if available
            if(window.navigator.vibrate) window.navigator.vibrate(50);
        }

        function downloadJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(storage));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "noorani_font_data.json");
            dlAnchorElem.click();
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    storage = JSON.parse(e.target.result);
                    updateUI();
                } catch(err) { alert('Invalid file'); }
            };
            reader.readAsText(file);
        }

        window.onload = () => { 
            resizeCanvas(); 
            selectL('A'); 
        };
    </script>
</body>
</html>